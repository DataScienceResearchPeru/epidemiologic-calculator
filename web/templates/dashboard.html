{% extends "base.html" %}

{% block css %}
<!-- Chart CSS-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css">
<style>
    .bar{
        fill: steelblue;
    }
</style>

<script src="https://d3js.org/d3.v4.min.js"></script>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-md-12">
            <h1>Epidemic Calculator 3</h1>

            <h2 class="py-3">SIR-D</h2>
            <canvas id="chart-sird" width="400" height="150"></canvas>

            <h2 class="py-3">SEIR-D</h2>
            <canvas id="chart-seird" width="400" height="150"></canvas>

            <h2 class="py-3">SEAICHUR-D <small class="text-muted">(en proceso)</small></h2>
            <canvas id="chart-seaichurd" width="400" height="150"></canvas>

            <br>
            <br>     
            <br>
            <br>                    
            <div style="width: 10%; margin: 0 auto;">
                <input type="range" min="0.0" max="1.0" step="0.01" value="0.0" onchange="modulevalue(this)">
            </div>

            <svg width="1200" height="600"></svg>

        </div>
    </div>
</div>

{% endblock %}

{% block js %}
<!-- Chart JS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
<script>

    var svg = d3.select("svg"),
        margin = 200,
        width = svg.attr("width") - margin,
        height = svg.attr("height") - margin

    svg.append("text")
       .attr("transform", "translate(100,0)")
       .attr("x", 50)
       .attr("y", 50)
       .attr("font-size", "24px")
       .text("SIR-D susceptible")

    var xScale = d3.scaleLinear().range([0, width]),
        yScale = d3.scaleLinear().range([height, 0]);

    var g = svg.append("g")
               .attr("transform", "translate(" + 100 + "," + 100 + ")");
             
    d3.json("/api/sird/0.00", function(error, data) {
   
        reloaddatad3(error, data)

    });

    function reloaddatad3(error, data){

        if (error) {
            throw error;
        }
        data2 = data.susceptible
        console.log(d3.max(data2))

        xScale.domain([0, data2.length]);
        yScale.domain([0, d3.max(data2)]);
        
        g.append("g")
         .attr("transform", "translate(0," + height + ")")
         .call(d3.axisBottom(xScale))
         .append("text")
         .attr("y", height -350)
         .attr("x", width - width/2)
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Tiempo(dias)");

        g.append("g")
         .call(d3.axisLeft(yScale))
         .append("text")
         .attr("transform", "rotate(-90)")
         .attr("y", 0)
         .attr("x", -height/2)         
         .attr("dy", "-8.1em")
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Poblaci√≥n");

        g.selectAll(".bar")
         .data(data2)
         .enter().append("rect")
         .attr("class", "bar")
         .attr("x", function(d,i) { return i*(width/data2.length); })
         .attr("y", function(d) { return yScale(d); })
         .attr("width", 2)
         .attr("height", function(d) { return height - yScale(d); });
      
    }


</script>


<script>

    function modulevalue(el){
        if(el.value== 0)
            a1p = "0.0"
        else{
            a1p = el.value
            console.log(a1p)    
        }

        d3.selectAll("svg g g, rect").remove()
        
        d3.json("/api/sird/"+a1p, function(error, data) {

            reloaddatad3(error, data)

        });
    }
        
</script>

{% endblock js %}